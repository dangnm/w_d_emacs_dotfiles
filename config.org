* Installation
** Setup Emacs dotfiles
ln -sf ~/w_d_emacs_dotfiles/config.org ~/.doom.d/config.org
** Enable org file config
Go to ~/.doom.d/init.el and uncomment literate
** Rebuild config
SPC h r r OR M-x doom/reload


*
* Tips
** Check all bindings
SPC h b b runs counsel-descbinds and will show all defined keys and their definitions.
* Helpers
** File path helpers
   #+BEGIN_SRC emacs-lisp
     (defun s/show-buffer-file-path ()
       "Show the full path to the current file in the minibuffer."
       (interactive)
       (let ((file-name (buffer-file-name)))
         (if file-name
             (progn
               (message file-name)
               (kill-new file-name))
           (error "Buffer not visiting a file"))))

     (defun w/show-buffer-project-path ()
       "Show the full path to the current project in the minibuffer."
       (interactive)
       (let ((project-path (projectile-project-root)))
         (if project-path
             (progn
               (message project-path)
               (kill-new project-path))
           (error "Buffer not visiting a project"))))

     (defun s/show-buffer-file-name ()
       "Show the full path to the current file in the minibuffer."
       (interactive)
       (let ((file-name (file-name-nondirectory(buffer-file-name))))
         (if file-name
             (progn
               (message file-name)
               (kill-new file-name))
           (error "Buffer not visiting a file"))))

     (defun w/show-buffer-file-name-base ()
       "Show current file name base in the minibuffer."
       (interactive)
       (let ((file-name (file-name-base(buffer-file-name))))
         (if file-name
             (progn
               (message file-name)
               (kill-new file-name))
           (error "Buffer not visiting a file"))))

     (defun w/file-path-with-line ()
       "Retrieve the file path of the current buffer, including line number.

     Returns:
       - A string containing the file path in case of success.
       - `nil' in case the current buffer does not have a directory."
       (when-let (file-path (buffer-file-name))
         (concat file-path ":" (number-to-string (line-number-at-pos)))))

     (defun w/show-buffer-file-path-with-line ()
       "Show current file name base in the minibuffer."
       (interactive)
       (let ((file-name (w/file-path-with-line)))
         (if file-name
             (progn
               (message file-name)
               (kill-new file-name))
           (error "Buffer not visiting a file"))))
   #+END_SRC

** Text edit helpers
   #+BEGIN_SRC emacs-lisp
     (defun toggle-camelcase-underscores ()
       "Toggle between camelcase and underscore notation for the symbol at point."
       (interactive)
       (save-excursion
         (let* ((bounds (bounds-of-thing-at-point 'symbol))
                (start (car bounds))
                (end (cdr bounds))
                (currently-using-underscores-p (progn (goto-char start)
                                                      (re-search-forward "_" end t))))
           (if currently-using-underscores-p
               (progn
                 (upcase-initials-region start end)
                 (replace-string "_" "" nil start end)
                 (downcase-region start (1+ start)))
             (replace-regexp "\\([A-Z]\\)" "_\\1" nil (1+ start) end)
             (downcase-region start (cdr (bounds-of-thing-at-point 'symbol)))))))

     (defun toggle-camelcase-motion ()
       (interactive)
       (if (get 'camelcase-motion-toggle-flag 'state)
           (progn
             (message "Disabled camelcase motion")
             (subword-mode'-1)
             (put 'camelcase-motion-toggle-flag'state nil))
         (progn
           (message "Enabled camelcase motion")
           (subword-mode)
           (put 'camelcase-motion-toggle-flag 'state t))
         )
       )
   #+END_SRC

* Key bindings
** Commons
#+BEGIN_SRC emacs-lisp
(setq w/secondary-leader-key ",")
#+END_SRC
** Windows binding
#+BEGIN_SRC emacs-lisp
(map! :leader :desc "Split window right" "w/" (lambda () (interactive) (split-window-right) (other-window 1)))
#+END_SRC

** Jump binding
#+BEGIN_SRC emacs-lisp
(map! :leader :desc "jump" "j" nil)
(map! :leader :desc "dired jump" "jd" #'magit-dired-jump)
(map! :leader :desc "goto char" "jj" #'evil-avy-goto-char)
(map! :leader :desc "go to char 2" "jJ" #'evil-avy-goto-char-2)
(map! :leader :desc "goto line" "jl" #'evil-avy-goto-line)
(map! :leader :desc "go to word" "jw" #'evil-avy-goto-word-or-subword-1)
#+END_SRC

#+RESULTS:
: evil-avy-goto-word-or-subword-1

** Git binding
#+BEGIN_SRC emacs-lisp
(map! :leader :desc "Git link" "gll" #'git-link)
#+END_SRC

** Layouts
#+BEGIN_SRC emacs-lisp
(map! :leader :desc "Persp select" "l" #'w/persp-hydra/body)
#+END_SRC

** M-x command
#+BEGIN_SRC emacs-lisp
(map! :leader :desc "M-x command" "SPC" #'counsel-M-x)
#+END_SRC

** Dired secondary leader key
#+BEGIN_SRC emacs-lisp
       (general-define-key
        :states '(normal visual insert emacs)
        :prefix w/secondary-leader-key
        :non-normal-prefix "M-n"
        :keymaps 'dired-mode-map
        "," 'dired-up-directory
        "u" '(dired-unmark :which-key "unmark(u)")
        "m" '(dired-mark :which-key "mark(m)")
        "r" '(revert-buffer-no-confirm :which-key "refresh(r)")
        "j" 'dired-next-subdir
        "k" 'dired-prev-subdir
        "h" 'w/dired-go-to-home-folder
        "F" 'find-name-dired
                                             ;Actions
        "a" '(:ignore t :which-key "Actions")
        "af" '(:ignore t :which-key "Files")
        "afn" '(find-file :which-key "Create file")
        "afN" 'dired-create-directory
        "afr" '(dired-do-rename :which-key "Rename(Shift + r)")
        "afd" '(dired-do-delete :which-key "Delete(Shift + d)")
        "ae" '(:ignore t :which-key "Edit")
        "aex" '(dired-copy-paste-do-cut :which-key "Cut")
        "aec" '(dired-copy-paste-do-copy :which-key "Copy")
        "aep" '(dired-copy-paste-do-paste :which-key "Paste")
                                             ;Toggle
        "T" '(:ignore t :which-key "toggles")
        "Td" 'dired-hide-details-mode
        )
     (defun w/dired-go-to-home-folder ()
       (interactive)
       (if (not(string= "~/" default-directory))
           (find-alternate-file "~/")
         )
       )

     (defun dired-copy-paste-do-cut ()
       "In dired-mode, cut a file/dir on current line or all marked file/dir(s)."
       (interactive)
       (setq dired-copy-paste-stored-file-list (dired-get-marked-files)
             dired-copy-paste-func 'rename-file)
       (message
        (format "%S is/are cut."dired-copy-paste-stored-file-list)))


     (defun dired-copy-paste-do-copy ()
       "In dired-mode, copy a file/dir on current line or all marked file/dir(s)."
       (interactive)
       (setq dired-copy-paste-stored-file-list (dired-get-marked-files)
             dired-copy-paste-func 'copy-file)
       (message
        (format "%S is/are copied."dired-copy-paste-stored-file-list)))


     (defun dired-copy-paste-do-paste ()
       "In dired-mode, paste cut/copied file/dir(s) into current directory."
       (interactive)
       (let ((stored-file-list nil))
         (dolist (stored-file dired-copy-paste-stored-file-list)
           (condition-case nil
               (progn
                 (funcall dired-copy-paste-func stored-file (dired-current-directory) 1)
                 (push stored-file stored-file-list))
             (error nil)))
         (if (eq dired-copy-paste-func 'rename-file)
             (setq dired-copy-paste-stored-file-list nil
                   dired-copy-paste-func nil))
         (revert-buffer)
         (message
          (format "%d file/dir(s) pasted into current directory." (length stored-file-list)))))
#+END_SRC

* Other tools configs
** Workspace (PERSP MODE) config
save/recover sessions
#+BEGIN_SRC emacs-lisp
     (defun w/ivy-persp-switch-project (arg)
       (interactive "P")
       (persp-mode)
       (helm-projectile-configs-load)
       (ivy-mode)
       (define-key ivy-minibuffer-map (kbd "C-j") 'ivy-next-line)
       (define-key ivy-minibuffer-map (kbd "C-k") 'ivy-previous-line)
       (ivy-read "Switch to Project Perspective: "
                 (if (projectile-project-p)
                     (cons (abbreviate-file-name (projectile-project-root))
                           (projectile-relevant-known-projects))
                   projectile-known-projects)
                 :action (lambda (project)
                           (let* ((persp-reset-windows-on-nil-window-conf t)
                                  (exists (persp-with-name-exists-p project)))
                             (persp-switch project)
                             (unless exists
                               (progn
                                 (let ((projectile-completion-system 'ivy))
                                   (projectile-switch-project-by-name project))))))))

     ;; perspectives for emacs
     (defun w/persp-load-state-from-file ()
       (interactive)
       (persp-mode 1)
       (call-interactively 'persp-load-state-from-file)
       )

     (defun w/persp-save-state-to-file ()
       (interactive)
       (persp-mode 1)
       (call-interactively 'persp-save-state-to-file)
       )

     (use-package persp-mode
       :commands (persp-mode)
       :init
       (setq wg-morph-on nil ;; switch off animation
             persp-add-buffer-on-after-change-major-mode t
             persp-auto-resume-time -1
             persp-autokill-buffer-on-remove 'kill-weak
             persp-save-dir (expand-file-name "~/.emacs.d/.cache/layouts/"))
       )

     (defun w/persp-layout ()
       "Switch to perspective of position POS."
       (interactive)
       (let* ((persp-current-name (safe-persp-name (get-current-persp)))
              (highlight-persps (lambda (elt idx)
                                  (format (if (string= elt persp-current-name) "%d *%s*" "%d %s")
                                          (+ idx 1)
                                          (if (string= elt "none") elt (f-base elt))))))
         (string-join (seq-map-indexed highlight-persps (persp-names-current-frame-fast-ordered)) " | ")))


     (defun w/persp-switch-to-number(number)
       (persp-switch (nth (1+ (- number 2)) (persp-names-current-frame-fast-ordered)))
       )

     (use-package hydra
       :ensure t
       :defer t
       )

     (defhydra w/persp-hydra
       (:color pink :hint nil :exit t)
       "Layout: %s(w/persp-layout)"
       ("n" persp-next "Next Layout" :column "Go to")
       ("p" persp-prev "Prev Layout")
       ("l" persp-switch "Switch Layout")
       ("1" (w/persp-switch-to-number 1))
       ("2" (w/persp-switch-to-number 2))
       ("3" (w/persp-switch-to-number 3))
       ("4" (w/persp-switch-to-number 4))
       ("5" (w/persp-switch-to-number 5))
       ("6" (w/persp-switch-to-number 6))
       ("7" (w/persp-switch-to-number 7))
       ("8" (w/persp-switch-to-number 8))
       ("9" (w/persp-switch-to-number 9))

       ("d" persp-kill :column "Actions")
       ("r" persp-rename)
       ("s" w/persp-save-state-to-file "Save Layout")
       ("L" w/persp-load-state-from-file "Load Layout")
       ("q" nil "cancel" :color blue :column nil))

   #+END_SRC
